javascript:(function(){function show(m){if(typeof WF!=='undefined'&&WF.showMessage){WF.showMessage(m);setTimeout(WF.hideMessage,2000);}else{alert(m);}}function parseSpecialTag(tag){let h=tag.replace(/^#/,'');if(/^[pP]\d+$/.test(h)){return['P',h.replace(/^[pP]/,'')];}if(/^[^-\s]+-[^-\s]+$/.test(h)){let p=h.split('-');return[p[0],p.slice(1).join('-')];}return null;}function stripTags(str){return str.replace(/#[^\s]+/g,'').trim();}function sortTableByColumn(tbl,colIndex,asc){let tBody=tbl.querySelector('tbody');let rows=Array.from(tBody.querySelectorAll('tr'));rows.sort(function(a,b){let c1=a.children[colIndex].textContent.trim().toLowerCase(),c2=b.children[colIndex].textContent.trim().toLowerCase();let n1=parseFloat(c1),n2=parseFloat(c2);if(!isNaN(n1)&&!isNaN(n2))return asc?(n1-n2):(n2-n1);return asc?c1.localeCompare(c2):c2.localeCompare(c1);});rows.forEach(r=>tBody.appendChild(r));}function makeCell(x){let c=document.createElement('td');c.style.border='1px solid #ccc';c.style.padding='6px';if(typeof x==='string')x=document.createTextNode(x);c.appendChild(x);return c;}function loadAllBullets(done){let oldScroll=0,stable=0,maxStable=3;window.scrollTo(0,document.body.scrollHeight);let intv=setInterval(function(){window.scrollTo(0,document.body.scrollHeight);let newScroll=document.body.scrollHeight;if(newScroll===oldScroll){stable++;}else{stable=0;oldScroll=newScroll;}if(stable>=maxStable){clearInterval(intv);done();}},800);}function buildTable(){show('Gathering bullets...');let root=document.querySelector('div[projectid].project.root.selected');/* match either "project shared selected root" or "project selected root" etc. */if(!root){show('No root bullet found (div[projectid].project.root.selected)!');return;}let bulletSelector='.innerContentContainer',bullets=document.querySelectorAll(bulletSelector),bulletDataList=[],allProps=new Set();if(!bullets.length){show('No bullets found for selector "'+bulletSelector+'"!');return;}bullets.forEach(function(b){let txt=b.textContent.trim(),allTags=txt.match(/#[^\s]+/g)||[],special=allTags.filter(t=>parseSpecialTag(t));if(!special.length)return;allTags.forEach(t=>{txt=txt.replace(t,'').trim();});let props={},leftover=[];allTags.forEach(function(t){let parsed=parseSpecialTag(t);if(parsed){let[pn,pv]=parsed;props[pn]=pv;allProps.add(pn);}else{leftover.push(t);}});let proj=b.closest('.project'),nameDiv=proj?proj.querySelector('.name'):null,linkEl=nameDiv?nameDiv.querySelector('a.bullet'):null;if(!linkEl)return;let href=linkEl.getAttribute('href')||'';let parentProj=proj&&proj.parentElement?proj.parentElement.closest('.project'):null,parName='',parHref='';if(parentProj){let pNameDiv=parentProj.querySelector('.name .innerContentContainer');if(pNameDiv){parName=stripTags(pNameDiv.textContent.trim());}let pLinkEl=parentProj.querySelector('.name a.bullet');if(pLinkEl){parHref=pLinkEl.getAttribute('href')||'';} }bulletDataList.push({parentName:parName||'(no parent)',parentHref:parHref,bulletText:txt||'(no text)',bulletHref:href,tags:leftover,properties:props});});if(!bulletDataList.length){show('No bullets with special tags found!');return;}show('Building table...');let container=document.createElement('div');let topBar=document.createElement('div');topBar.style.margin='10px';topBar.style.display='flex';topBar.style.gap='10px';/* collapse btn */let collapseBtn=document.createElement('button');collapseBtn.textContent='Collapse Table';let isCollapsed=false;collapseBtn.onclick=function(){isCollapsed=!isCollapsed;table.style.display=isCollapsed?'none':'';};topBar.appendChild(collapseBtn);/* close btn */let closeBtn=document.createElement('button');closeBtn.textContent='Close Table';closeBtn.onclick=function(){container.remove();};topBar.appendChild(closeBtn);/* global filter */let globalFilter=document.createElement('input');globalFilter.placeholder='Filter ALL columns...';globalFilter.style.flex='1';topBar.appendChild(globalFilter);container.appendChild(topBar);let table=document.createElement('table');table.style.width='100%';table.style.borderCollapse='collapse';table.style.fontFamily='Arial,sans-serif';table.style.fontSize='14px';table.style.margin='20px';let thead=document.createElement('thead'),trHead=document.createElement('tr'),trFilter=document.createElement('tr');function makeHeadCell(lbl){let th=document.createElement('th');th.textContent=lbl;th.style.border='1px solid #ccc';th.style.padding='6px';th.style.cursor='pointer';return th;}function makeFilterCell(){let td=document.createElement('td');td.style.border='1px solid #ccc';td.style.padding='3px';let inp=document.createElement('input');inp.style.width='95%';inp.placeholder='Filter...';td.appendChild(inp);return{td:td,inp:inp};}let headers=['Parent','Bullet','Tags'],propArray=Array.from(allProps);headers=headers.concat(propArray);let filterInputs=[];headers.forEach(function(h){let th=makeHeadCell(h),fc=makeFilterCell();trHead.appendChild(th);trFilter.appendChild(fc.td);filterInputs.push(fc.inp);});thead.appendChild(trHead);thead.appendChild(trFilter);table.appendChild(thead);let tbody=document.createElement('tbody');bulletDataList.forEach(function(d){let row=document.createElement('tr');/* parent col link */(function(){let a=document.createElement('a');a.href=d.parentHref;a.textContent=d.parentName;a.style.color='blue';a.style.textDecoration='underline';a.onclick=function(e){e.preventDefault();if(a.href){window.location.href=a.href;}};row.appendChild(makeCell(a));})();/* bullet col link */(function(){let a=document.createElement('a');a.href=d.bulletHref;a.textContent=d.bulletText;a.style.color='blue';a.style.textDecoration='underline';a.onclick=function(e){e.preventDefault();window.location.href=a.href;};row.appendChild(makeCell(a));})();row.appendChild(makeCell(d.tags.join(' ')));propArray.forEach(function(p){row.appendChild(makeCell(d.properties[p]||''));});tbody.appendChild(row);});table.appendChild(tbody);container.appendChild(table);root.parentNode.insertBefore(container,root);/* sorting on header click */let headCells=trHead.querySelectorAll('th');headCells.forEach(function(h,i){let asc=true;h.onclick=function(){sortTableByColumn(table,i,asc);asc=!asc;};});/* filtering */function filterRows(){let allRows=tbody.querySelectorAll('tr'),gVal=globalFilter.value.trim().toLowerCase();allRows.forEach(function(r){let tds=r.querySelectorAll('td'),visible=true;for(let c=0;c<filterInputs.length;c++){let fv=filterInputs[c].value.trim().toLowerCase();if(fv&&!tds[c].textContent.toLowerCase().includes(fv)){visible=false;break;} }if(visible&&gVal){let rowHasGlobal=false;for(let c2=0;c2<tds.length;c2++){if(tds[c2].textContent.toLowerCase().includes(gVal)){rowHasGlobal=true;break;} }if(!rowHasGlobal)visible=false;}r.style.display=visible?'':'none';});}filterInputs.forEach(inp=>{inp.oninput=filterRows;});globalFilter.oninput=filterRows;window.scrollTo(0,0);show('Done! Table built at top.');}show('Scrolling to load all bullets...');loadAllBullets(buildTable);})();
