javascript:(function(){function show(m){if(typeof WF!=='undefined'&&WF.showMessage){WF.showMessage(m);setTimeout(WF.hideMessage,2000);}else{alert(m);}}function parseSpecialTag(t){let h=t.replace(/^#/,'');if(/^[pP]\d+$/.test(h))return['P',h.replace(/^[pP]/,'')];if(/^[^-\s]+-[^-\s]+$/.test(h)){let p=h.split('-');return[p[0],p.slice(1).join('-')];}return null;}function stripTags(s){return s.replace(/#[^\s]+/g,'').trim();}function sortTableByColumn(tbl,colIndex,asc){let tBody=tbl.querySelector('tbody'),rows=Array.from(tBody.querySelectorAll('tr'));rows.sort(function(a,b){let c1=a.children[colIndex].textContent.trim().toLowerCase(),c2=b.children[colIndex].textContent.trim().toLowerCase(),n1=parseFloat(c1),n2=parseFloat(c2);if(!isNaN(n1)&&!isNaN(n2))return asc?(n1-n2):(n2-n1);return asc?c1.localeCompare(c2):c2.localeCompare(c1);});rows.forEach(r=>tBody.appendChild(r));}function makeCell(x){let c=document.createElement('td');c.style.border='1px solid #ccc';c.style.padding='6px';if(typeof x==='string')x=document.createTextNode(x);c.appendChild(x);return c;}function loadAllBullets(done){let oldScroll=0,stable=0,maxStable=3;window.scrollTo(0,document.body.scrollHeight);let intv=setInterval(function(){window.scrollTo(0,document.body.scrollHeight);let newScroll=document.body.scrollHeight;if(newScroll===oldScroll){stable++;}else{stable=0;oldScroll=newScroll;}if(stable>=maxStable){clearInterval(intv);done();}},800);}function buildTable(){show('Creating table...');let overlay=document.createElement('div');overlay.id='customTableOverlay';overlay.style.position='fixed';overlay.style.top='0';overlay.style.left='0';overlay.style.width='100%';overlay.style.height='100%';overlay.style.backgroundColor='rgba(0,0,0,0.5)';overlay.style.zIndex='9999';overlay.style.display='flex';overlay.style.justifyContent='center';overlay.style.alignItems='center';overlay.style.color='white';overlay.style.fontSize='24px';overlay.textContent='Creating table...';document.body.appendChild(overlay);let root=document.querySelector('div[projectid].project.root.selected');if(!root){show('No root bullet found (div[projectid].project.root.selected)!');overlay.remove();return;}let bulletSelector='.innerContentContainer',bullets=document.querySelectorAll(bulletSelector),bulletDataList=[],allProps=new Set();if(!bullets.length){show('No bullets found for selector "'+bulletSelector+'"!');overlay.remove();return;}bullets.forEach(function(b){let txt=b.textContent.trim(),allTags=txt.match(/#[^\s]+/g)||[],special=allTags.filter(t=>parseSpecialTag(t));if(!special.length)return;allTags.forEach(tg=>{txt=txt.replace(tg,'').trim();});let props={},leftover=[];allTags.forEach(function(tg){let parsed=parseSpecialTag(tg);if(parsed){let[pn,pv]=parsed;props[pn]=pv;allProps.add(pn);}else leftover.push(tg);});let proj=b.closest('.project'),nameDiv=proj?proj.querySelector('.name'):null,linkEl=nameDiv?nameDiv.querySelector('a.bullet'):null;if(!linkEl)return;let href=linkEl.getAttribute('href')||'',parentProj=proj&&proj.parentElement?proj.parentElement.closest('.project'):null,parName='',parHref='';if(parentProj){let pNameDiv=parentProj.querySelector('.name .innerContentContainer');if(pNameDiv)parName=stripTags(pNameDiv.textContent.trim());let pLinkEl=parentProj.querySelector('.name a.bullet');if(pLinkEl)parHref=pLinkEl.getAttribute('href')||'';}bulletDataList.push({parentName:parName||'(no parent)',parentHref:parHref,bulletText:txt||'(no text)',bulletHref:href,tags:leftover,properties:props});});if(!bulletDataList.length){show('No bullets with special tags found!');overlay.remove();return;}let container=document.createElement('div');container.id='customTableContainer';let topBar=document.createElement('div');topBar.style.margin='10px';topBar.style.display='flex';topBar.style.gap='10px';/* collapse btn */let collapseBtn=document.createElement('button');collapseBtn.innerHTML='<i data-lucide="list-collapse" size="16" stroke-width="1"></i>';collapseBtn.style.cursor='pointer';collapseBtn.onclick=function(){let tbl=container.querySelector('table');if(tbl){tbl.style.display=tbl.style.display==='none'?'':'none';}};/* refresh btn */let refreshBtn=document.createElement('button');refreshBtn.innerHTML='<i data-lucide="refresh-cw" size="16" stroke-width="1"></i>';refreshBtn.style.cursor='pointer';refreshBtn.onclick=function(){if(document.querySelector('#customTableContainer')){document.querySelectorAll('#customTableContainer').forEach(tbl=>tbl.remove());}loadAllBullets(buildTable);};/* close btn */let closeBtn=document.createElement('button');closeBtn.innerHTML='<i data-lucide="square-x" size="16" stroke-width="1"></i>';closeBtn.style.cursor='pointer';closeBtn.onclick=function(){container.remove();};/* global filter */let globalFilter=document.createElement('input');globalFilter.placeholder='Filter ALL columns...';globalFilter.style.flex='1';globalFilter.style.padding='4px';/* Append buttons in order */topBar.appendChild(collapseBtn);topBar.appendChild(refreshBtn);topBar.appendChild(globalFilter);topBar.appendChild(closeBtn);container.appendChild(topBar);/* create table */let table=document.createElement('table');table.style.width='100%';table.style.borderCollapse='collapse';table.style.fontFamily='Arial,sans-serif';table.style.fontSize='14px';table.style.margin='20px';let thead=document.createElement('thead'),trHead=document.createElement('tr'),trFilter=document.createElement('tr');function makeHeadCell(lbl){let th=document.createElement('th');th.textContent=lbl;th.style.border='1px solid #ccc';th.style.padding='6px';th.style.cursor='pointer';return th;}function makeFilterCell(){let td=document.createElement('td');td.style.border='1px solid #ccc';td.style.padding='3px';let inp=document.createElement('input');inp.style.width='95%';inp.placeholder='Filter...';inp.style.padding='2px';td.appendChild(inp);return{td:td,inp:inp};}let headers=['Parent','Bullet','Tags'],propArray=Array.from(allProps);headers=headers.concat(propArray);let filterInputs=[];headers.forEach(function(h){let th=makeHeadCell(h),fc=makeFilterCell();trHead.appendChild(th);trFilter.appendChild(fc.td);filterInputs.push(fc.inp);});thead.appendChild(trHead);thead.appendChild(trFilter);table.appendChild(thead);let tbody=document.createElement('tbody');bulletDataList.forEach(function(d){let row=document.createElement('tr');/****** Parent column ******/(function(){let a=document.createElement('a');a.href=d.parentHref;a.textContent=d.parentName;a.style.color='blue';a.style.textDecoration='underline';a.onclick=function(e){e.preventDefault();if(a.href){window.location.href=a.href;setTimeout(function(){ window.location.reload(); },100);}};row.appendChild(makeCell(a));})();/****** Bullet column ******/(function(){let a=document.createElement('a');a.href=d.bulletHref;a.textContent=d.bulletText;a.style.color='blue';a.style.textDecoration='underline';a.onclick=function(e){e.preventDefault();window.location.href=a.href;setTimeout(function(){ window.location.reload(); },100);};row.appendChild(makeCell(a));})();/****** Tags column ******/row.appendChild(makeCell(d.tags.join(' ')));/****** Properties columns ******/propArray.forEach(function(p){row.appendChild(makeCell(d.properties[p]||''));});tbody.appendChild(row);});table.appendChild(tbody);container.appendChild(table);root.parentNode.insertBefore(container,root);/* Sorting on header click */let headCells=trHead.querySelectorAll('th');headCells.forEach(function(h,i){let asc=true;h.onclick=function(){sortTableByColumn(table,i,asc);asc=!asc;};});/* Filtering */function filterRows(){let allRows=tbody.querySelectorAll('tr'),gVal=globalFilter.value.trim().toLowerCase();allRows.forEach(function(r){let tds=r.querySelectorAll('td'),visible=true;/* Process global filter */if(gVal){let includeTerms=[],excludeTerms=[];gVal.split(',').forEach(function(term){term=term.trim();if(term.startsWith('!')){excludeTerms.push(term.slice(1).toLowerCase());}else{includeTerms.push(term.toLowerCase());}});if(includeTerms.length>0){let matchInclude=false;includeTerms.forEach(function(term){if(Array.from(tds).some(td=>td.textContent.toLowerCase().includes(term))){matchInclude=true;}});if(!matchInclude){visible=false;}} if(excludeTerms.length>0){let matchExclude=false;excludeTerms.forEach(function(term){if(Array.from(tds).some(td=>td.textContent.toLowerCase().includes(term))){matchExclude=true;}});if(matchExclude){visible=false;}}}/* Process per-column filters */for(let c=0;c<filterInputs.length;c++){let fv=filterInputs[c].value.trim().toLowerCase();if(fv){let includeTerms=[],excludeTerms=[];fv.split(',').forEach(function(term){term=term.trim();if(term.startsWith('!')){excludeTerms.push(term.slice(1).toLowerCase());}else{includeTerms.push(term.toLowerCase());}});let cellText=tds[c].textContent.toLowerCase();if(includeTerms.length>0){let matchInclude=false;includeTerms.forEach(function(term){if(cellText.includes(term)){matchInclude=true;}});if(!matchInclude){visible=false;break;}} if(excludeTerms.length>0){let matchExclude=false;excludeTerms.forEach(function(term){if(cellText.includes(term)){matchExclude=true;}});if(matchExclude){visible=false;break;}}}}r.style.display=visible?'':'none';});}filterInputs.forEach(inp=>{inp.oninput=filterRows;});globalFilter.oninput=filterRows;/* Initialize lucide icons */if(!window.lucide){let sc=document.createElement('script');sc.src='https://cdn.jsdelivr.net/npm/lucide@latest/dist/umd/lucide.js';sc.onload=function(){if(window.lucide)window.lucide.createIcons();};document.head.appendChild(sc);}else{lucide.createIcons();}/* Remove overlay */overlay.remove();show('Done! Table built at top.');window.scrollTo(0,0);}function initTableCreation(){if(document.querySelector('#customTableContainer')){document.querySelectorAll('#customTableContainer').forEach(tbl=>tbl.remove());}loadAllBullets(buildTable);}function injectTableButton(){/* Remove existing table buttons to prevent duplicates */let existingBtn=document.querySelector('.headerTableButton');if(existingBtn){existingBtn.remove();}/* Find the share button */let shareBtn=document.querySelector('.headerShareButton._3hmsj.iconButton.lg.shape-circle[data-handbook="sharing.share"]');if(!shareBtn){show('Share button not found - cannot insert table icon.');return;}/* Create table button */let tableBtn=document.createElement('div');tableBtn.className='headerTableButton _3hmsj.iconButton lg shape-circle';tableBtn.style.cursor='pointer';tableBtn.innerHTML='<i data-lucide="table-properties" size="16" stroke-width="1"></i>';tableBtn.onclick=function(){if(document.querySelector('#customTableContainer')){document.querySelectorAll('#customTableContainer').forEach(tbl=>tbl.remove());}else{initTableCreation();}};shareBtn.parentNode.insertBefore(tableBtn,shareBtn);/* Load lucide icons */if(!window.lucide){let sc=document.createElement('script');sc.src='https://cdn.jsdelivr.net/npm/lucide@latest/dist/umd/lucide.js';sc.onload=function(){if(window.lucide)window.lucide.createIcons();};document.head.appendChild(sc);}else{lucide.createIcons();}}/* Prevent duplicate table buttons when running bookmarklet from favorites */injectTableButton();})();
